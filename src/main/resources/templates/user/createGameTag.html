<!DOCTYPE html>
<html layout:decorate="~{common/layout.html}">
<head>
    <title>ë‚˜ì˜ ê²Œì„ ëª©ë¡</title>
    <style>
        .custom-card {
            background-color: #2d2d2d;
            border: 0px;
        }

        .active-button:hover {
            background-color: #dc5804;
            border-color: #dc5804;
        }


    </style>
</head>
<body>
<main layout:fragment="main">
    <div th:if="${gameList.size()} != 0">
        <form id="gameTagForm" action="/user/createGameTag/save-gametag" method="post"
              th:action="@{/user/createGameTag/save-gametag}">
            <div class="m-auto container">
                <div class="flex justify-center">
                    <p class="m-8 text-2xl">ì„ í˜¸í•˜ëŠ” ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!</p>
                </div>
                <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-5">
                    <div th:each="game : ${gameList}" class="card card-compact w-96 bg-base-100 shadow-xl custom-card"
                         style="max-width: 100%; max-height: 100%;">
                        <img th:src="@{'https://steamcdn-a.akamaihd.net/steam/apps/' + ${game.appid} + '/header.jpg'}"
                             alt="ê²Œì„ ì´ë¯¸ì§€" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title" th:text="${game.name}" style="font-size: 14px;"></h5>
                            <div class="card-actions justify-end">
                                <!--                            <input type="checkbox" class="checkbox checkbox-success checkbox-lg " style="border-color: #878787; accent-color: purple; n" name="selectedGames" th:value="${game.appid}" />-->
                                <input type="checkbox" class="checkbox checkbox-lg"
                                       style="border-color: #878787; --chkbg: 213, 14%, 69%; --chkfg: 0, 0%, 17%;"
                                       name="selectedGames" th:value="${game.appid}"/>
                                <input type="hidden" name="selectedGames" id="selectedGamesInput"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="m-8 flex justify-center">
                    <div class="pagination">
                        <ul class="flex space-x-4 flex-row">
                            <li th:if="${currentPage != 0}" th:class="${currentPage == 0 ? 'disabled' : ''}">
                                <a th:href="@{/user/createGameTag(page=${currentPage - 1}, size=${size})}">&laquo;
                                    ì´ì „ </a>
                            </li>
                            <li th:if="${currentPage != totalPages - 1}"
                                th:class="${currentPage == totalPages - 2 ? 'disabled' : ''}">
                                <a th:href="@{/user/createGameTag(page=${currentPage + 1}, size=${size})}">ë‹¤ìŒ
                                    &raquo;</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="flex justify-end">
                    <button id="saveButton" class="btn active-button bg-[#FF6B00]"
                            style="border-color: #FF6B00; border-radius: 5px 5px 5px 5px;">ì €ì¥
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div th:if="${gameList.size()} == 0" class="flex flex-col justify-center items-center">
        <div class="h-56"></div>
        <a href="/explain" class="mt-50 hover:underline">ğŸ‘‰ ê²Œì„ì´ ì•ˆë³´ì´ì‹œë‚˜ìš”?</a>
    </div>

    <script>

        // ì„ íƒí•œ ê²Œì„ë“¤ì„ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function saveSelectedGamesToStorage() {
            sessionStorage.setItem('selectedGames', JSON.stringify(selectedGames));
        }

        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„ íƒí•œ ê²Œì„ë“¤ì„ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
        function loadSelectedGamesFromStorage() {
            var selectedGamesStr = sessionStorage.getItem('selectedGames');
            if (selectedGamesStr) {
                selectedGames = JSON.parse(selectedGamesStr);
            }
        }

        // ì„ íƒí•œ ê²Œì„ë“¤ì„ ì €ì¥í•  ë°°ì—´
        var selectedGames = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„ íƒí•œ ê²Œì„ë“¤ ë¡œë“œ
        loadSelectedGamesFromStorage();

        // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì‹œ ì„ íƒí•œ ê²Œì„ ëª©ë¡ ì—…ë°ì´íŠ¸
        var checkboxes = document.querySelectorAll('input[type="checkbox"][name="selectedGames"]');
        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                var gameId = this.value;
                if (this.checked) {
                    // ì²´í¬í•œ ê²Œì„ì´ ì´ë¯¸ ì„ íƒëœ ê²Œì„ ëª©ë¡ì— ì—†ì„ ê²½ìš°ì—ë§Œ ì¶”ê°€
                    if (!selectedGames.includes(gameId)) {
                        selectedGames.push(gameId);
                    }
                } else {
                    // ì²´í¬ í•´ì œí•œ ê²Œì„ ì œê±°
                    var index = selectedGames.indexOf(gameId);
                    if (index > -1) {
                        selectedGames.splice(index, 1);
                    }
                }
                // ì„ íƒí•œ ê²Œì„ ëª©ë¡ì„ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                saveSelectedGamesToStorage();
            });
        });

        // ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ ì„ íƒí•œ ê²Œì„ë“¤ì„ ì„œë²„ë¡œ ì „ì†¡
        document.getElementById('saveButton').addEventListener('click', function () {
            // ì´ë¯¸ hidden inputì´ ìˆëŠ” ê²½ìš°, ì œê±°
            var existingHiddenInput = document.getElementById('selectedGamesInput');
            if (existingHiddenInput) {
                existingHiddenInput.remove();
            }

            // ì„ íƒí•œ ê²Œì„ë“¤ì„ hidden inputìœ¼ë¡œ ì¶”ê°€í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡
            var hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'selectedGames';
            hiddenInput.value = selectedGames.join(',');
            document.getElementById('gameTagForm').appendChild(hiddenInput);

            document.getElementById('gameTagForm').addEventListener('submit', function (event) {
                // ì„ íƒí•œ ê²Œì„ ëª©ë¡ì´ ë¹„ì–´ìˆìœ¼ë©´ í¼ ì œì¶œì„ ì¤‘ë‹¨í•˜ê³  ê²½ê³  ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤Œ
                if (selectedGames == null || selectedGames.length === 0) {
                    event.preventDefault(); // í¼ ì œì¶œ ì¤‘ë‹¨
                    alert("ì„ íƒí•œ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤! ê²Œì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
                    return;
                }
                // í¼ ì œì¶œ
                document.getElementById('gameTagForm').submit();
            });


            // í¼ ì œì¶œ í›„ í•´ë‹¹ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
            sessionStorage.removeItem('selectedGames');
        });
    </script>
</main>
</body>

</html>