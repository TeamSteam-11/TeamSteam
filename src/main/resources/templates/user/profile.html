<html layout:decorate="~{common/layout.html}">
<head>
    <meta charset="UTF-8"/>
    <title>프로필</title>
    <style>
        body {
            color:white;
        }

        .table {
            display: flex;
            justify-content: center;
            margin-top: 50px;
        }

        .table thead tr:first-child th,
        .table thead tr:first-child td {
            background-color: #1F2227;
            text-align: center;
        }

        .table tbody tr th,
        .table tbody tr td {
            background-color: #202d3e;
            border:0px;
            text-align: center;
        }
        .custom-card{
            background-color: #202d3e;
            border:0px;

        }
        .custom-card2{
            background-color: #202d3e;
            border:0px;
            margin-top: 30px;
        }
        .progress-custom {
            background-image: linear-gradient(90deg, #1c92d2 0%,#f2fcfe 100%);
            height: 30px;
        }
        .progress-custom2 {
            background-image: linear-gradient(90deg, #1c92d2 0%,#f2fcfe 100%);
            height: 4px;
        }

    </style>
</head>
<body>
<main layout:fragment="main">
    <div class="card lg:card-side bg-base-100 shadow-xl custom-card" style="height: 400px; overflow: auto; display: flex;">
        <div>
        <figure class="ml-8 mt-8" style="width: 150px;">
            <div class="w-48 h-48">
                <img th:src="${targetUser.getAvatar()}" class="w-full h-full object-cover">
            </div>
        </figure>
        </div>
        <div class="card-body" style="display: flex; margin-top: 1px;">
            <h1 class="my-2 text-3xl" th:text="${targetUser.getUsername()}" style="color: #dddddd;"></h1>
            <div class="ml-4" style="width: calc(100% - 150px);">
                        <div class="flex pt-4" style="display: flex; flex-direction: column">
                        <div class="table-cell">
                            <div class="flex flex-wrap">
                                <div th:if="${!targetUser.getUserTag().getGameTag().isEmpty()}" th:each="targetUserGameTag : ${targetUser.getUserTag().getGameTag()}" class="badge bg-sky-500 badge-accent inline max-w-[10rem]">
                                    <span th:text="${targetUserGameTag.getName()}"></span>
                                </div>
                            </div>
                        </div>
                        <div class="table-cell">
                            <div class="flex flex-wrap">
                                <div th:if="${!targetUser.getUserTag().getGenreTag().isEmpty()}" th:each="targetUserGenreTag : ${targetUser.getUserTag().getGenreTag()}" class="badge bg-green-500 badge-accent inline max-w-[10rem]">
                                    <span th:text="${targetUserGenreTag.getGenre()}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="pt-4">
                <p class="mb-2">매너온도:<span th:text="${targetUser.getTemperature()}"></span></p>
                <progress class="progress progress-accent w-56 progress-custom" th:value="${targetUser.getTemperature()}" max="100">
                </progress>
                </div>
            </div>
            <div class="card-actions justify-end">
                <form th:action="@{/user/profile/editprofile}" method="post">
                    <button th:if="${loginedId == targetUser.getId()}" class="btn btn-accent">Edit Tag</button>
                    <input type="submit" value="">
                </form>
                <form th:action="@{/user/profile/{userId}/addFriend(userId=${targetUser.id})}" method="post">
                    <button th:if="${loginedId != targetUser.getId()}" class="btn btn-accent">친구추가</button>
                    <input type="submit" value="">
                </form>
            </div>
        </div>
    </div>
    <div th:if="${loginedId == targetUser.getId()}">
        <div class="flex justify-between mx-8">
            <div class="overflow-x-auto">
                <h2 class="text-xl font-semibold mb-4">친구 목록</h2>
                <th:block th:if="${!friendsList.isEmpty()}">
                    <table class="table">
                        <tbody>
                        <tr th:each="friend: ${friendsList}">
                            <td>
                                <div class="flex items-center space-x-3">
                                    <div class="avatar">
                                        <div class="mask mask-squircle w-12 h-12">
                                            <img th:src="${friend.getFriend().getAvatar()}" class="w-8 h-8 rounded-full">
                                        </div>
                                    </div>
                                    <div>
                                        <div class="font bold" th:text="${friend.getFriend().getUsername()}"></div>
                                    </div>
                                </div>
                            <th>
                                <label>
                                    <a th:href="@{'/user/profile/' + ${friend.getFriend().getId()} +'/deleteFriend'}"
                                       class="daisy-btn daisy-btn_secondary daisy-btn_icon daisy-btn_rounded">
                                        친구 삭제
                                    </a>
                                </label>
                            </th>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </th:block>
                <th:block th:if="${friendsList.isEmpty()}">
                    <p class="text-gray-500">친구를 추가해주세요.</p>
                </th:block>
            </div>
            <div class="overflow-x-auto mx-8">
                <h2 class="text-xl font-semibold mb-4">최근 매칭된 유저</h2>
                <th:block th:if="${!recentlyUserList.isEmpty()}">
                    <table class="table">
                        <tbody>
                        <tr th:each="recentlyUser: ${recentlyUserList}">
                            <td>
                                <div class="flex items-center space-x-3">
                                    <div class="avatar">
                                        <div class="mask mask-squircle w-12 h-12">
                                            <img th:src="${recentlyUser.getMatchingPartner().getUser().getAvatar()}" class="w-8 h-8 rounded-full">
                                        </div>
                                    </div>
                                    <div>
                                        <div class="font bold" th:text="${recentlyUser.getMatchingPartnerName()}"></div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <p class="mb-2">매너온도:
                                    <span th:text="${recentlyUser.getMatchingPartner().getUser().getTemperature()}"></span>
                                </p>
                                <progress class="progress progress-accent w-30 progress-custom2"
                                          th:value="${recentlyUser.getMatchingPartner().getUser().getTemperature()}" max="100">
                                </progress>
                            </td>
                            <th>
                                <label>
                                    <a th:id="'thumbsUpButton_' + ${recentlyUser.getMatchingPartner().getUser().getId()}"
                                       th:href="@{'/user/profile/' + ${recentlyUser.getMatchingPartner().getUser().getId()} +'/'+ ${1}}"
                                       class="daisy-btn daisy-btn_secondary daisy-btn_icon daisy-btn_rounded thumbs-up-button">
                                        <i class="fa fa-thumbs-up fa-lg"></i>
                                    </a>
                                </label>
                            </th>
                            <th>
                                <label>
                                    <a th:id="'thumbsDownButton_' + ${recentlyUser.getMatchingPartner().getUser().getId()}"
                                       th:href="@{'/user/profile/' + ${recentlyUser.getMatchingPartner().getUser().getId()} +'/'+ ${0}}"
                                       class="daisy-btn daisy-btn_secondary daisy-btn_icon daisy-btn_rounded thumbs-down-button">
                                        <i class="fa fa-thumbs-down fa-lg"></i>
                                    </a>
                                </label>
                            </th>
                        </tr>
                        </tbody>
                    </table>
                </th:block>
                <th:block th:if="${recentlyUserList.isEmpty()}">
                    <p class="text-gray-500">매칭을 시작해주세요.</p>
                </th:block>
            </div>
        </div>
    </div>




    <div class="card lg:card-side bg-base-100 shadow-xl custom-card2 ">
        <div class="card-body">
            <h2 class="card-title" style="color: #dddddd;">Game Library</h2>
            <div class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
                <div th:each="game : ${gameList}" class="card">
                    <img th:src="@{'https://steamcdn-a.akamaihd.net/steam/apps/' + ${game.appid} + '/header.jpg'}"
                         alt="게임 이미지" class="card-img-top">
                    <div class="card-body">
                        <h5 class="card-title" th:text="${game.name}"></h5>
                    </div>
                </div>
            </div>
            <div class="m-8 flex justify-center">
                <div class="pagination">
                    <ul class="flex space-x-4 flex-row">
                        <li th:class="${currentPage == 0 ? 'disabled' : ''}">
                            <a th:if="${currentPage != 0}" th:href="@{/user/profile/{userId}(userId=${userId},page=${currentPage - 1},size=${size})}">&laquo; 이전</a>
                            <span th:if="${currentPage == 0}">&laquo; 이전</span>
                        </li>
                        <li th:class="${currentPage == totalPages - 1 ? 'disabled' : ''}">
                            <a th:if="${currentPage != totalPages - 1}" th:href="@{/user/profile/{userId}(userId=${userId},page=${currentPage + 1},size=${size})}">다음 &raquo;</a>
                            <span th:if="${currentPage == totalPages - 1}">다음 &raquo;</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <script th:inline="javascript">
        $(document).ready(function() {
            $('.thumbs-up-button, .thumbs-down-button').click(function() {
                var buttonId = $(this).attr('id');
                $('#' + buttonId).closest('th').hide();
                $('#' + buttonId).closest('tr').find('.thumbs-up-button, .thumbs-down-button').hide();
                localStorage.setItem(buttonId, 'hidden');
            });

            $('.thumbs-up-button, .thumbs-down-button').each(function() {
                var buttonId = $(this).attr('id');
                var isHidden = localStorage.getItem(buttonId);
                if (isHidden === 'hidden') {
                    $('#' + buttonId).closest('th').hide();
                    $('#' + buttonId).closest('tr').find('.thumbs-up-button, .thumbs-down-button').hide();
                }
            });
        });
    </script>
</main>
</body>
</html>