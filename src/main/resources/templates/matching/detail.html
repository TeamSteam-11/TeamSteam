<html layout:decorate="~{common/layout.html}">

<head>
    <title>Matching Detail</title>
    <style>
        body {
            color:white;
        }

        .container {
            width: 80%;
            margin: 40px auto;
            padding: 20px;
            /*border: 1px solid #ccc;*/
            box-shadow: 2px 2px 4px 0px rgba(0, 0, 0, 0.5);
        }

        .information-card {
            display: flex;
            width: 80%;
            height: 80px;
        }

        .user-profile {
            width: 50px;
            height: 50px;
        }

        .user-name {
            margin: 10px;
        }

        .title {
            font-size: large;
            color: #9E9D9D;
            margin-left: 30px;
            margin-bottom: 20px;
        }

        .matching-information {
            height: 400px;
        }

        .content-box {
            height: auto;
            margin: 10px;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #ccc;
            color: #9E9D9D;
        }

        .content {
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .matching-owner {
            display: flex;
            justify-content: flex-end;
        }

        .participant-button {
            display: flex;
            justify-content: flex-end;
            margin-right: 10%;
        }

        .mini-profile {
            display: flex;
            width: 300px;
            margin-left: 10%;
            margin-right: 10%;
        }

        .tag-table {
            background-color: transparent;
            border-color: transparent;
        }
    </style>
</head>
<body>
<main layout:fragment="main">
    <div class="container">
        <div class="information-card">
            <img class="user-profile" th:src="${matching.user.getAvatar()}">
            <span class="user-name" th:text="${matching.user.username}"></span>
            <span class="badge badge-outline" style="float: right" th:text="|${matching.participant} / ${matching.capacity}|"></span>
        </div>
        <!-- YYYY년 M월 d일 h시 m분으로 변경 -->
        <span style="float: right" th:text="${#temporals.format(matching.getModifyDate(), 'yyyy/MM/dd hh:mm')}"></span>

        <div class="matching-information">
            <span class="title" th:text="${matching.title}">제목</span>
            <div class="content-box">

                <div>
                    <span class="badge bg-green-500 badge-accent inline max-w-[10rem]" th:text="${matching.getGenre()}"></span>
                    <span class="badge bg-sky-500 badge-accent inline max-w-[10rem]" th:text="${matching.gameTagName}">게임 제목</span>
                </div>

                <span class="content" th:text="${matching.content}">내용</span>

                <div class="matching-owner">
                    <form th:if="${@rq.isLogin()}" th:action="@{/match/detail/delete/{id}(id=${matching.id})}" method="post">
                        <button type="submit" class="btn btn-light border" style="background-color: #1F2227; color: white"
                                th:if="${matching.user.id == @rq.user.id}"
                                onclick="return confirm('해당 게시물을 삭제하시겠습니까?')">삭제
                        </button>
                    </form>
                    <form th:if="${@rq.isLogin()}" th:action="@{/match/modify/{id}(id=${matching.id})}">
                        <button type="submit" class="btn btn-light border"
                                th:if="${matching.user.id == @rq.user.id}"
                                onclick="return confirm('해당 게시물을 수정하시겠습니까?')">수정
                        </button>
                    </form>
                </div>

            </div>
        </div>

<!--        <span th:text="${matching.startTime}">시작 시간</span>-->
<!--        <span th:text="${matching.endTime}">종료 시간</span>-->
        <span th:text="${matching.deadlineDate}">마감 시간</span><br>
<!--        <span id="deadline"></span><br>-->
        <span th:text="${matching.getDeadlineDuration()}"></span> 후 마감
        <p><strong>모집 성별:</strong>
            <span th:switch="${matching.gender}">
              <span th:case="'F'">여성</span>
              <span th:case="'M'">남성</span>
              <span th:case="'DC'">성별무관</span>
            </span>


        <p><strong>참여 인원:</strong> <span th:text="${matching.participant}">참여 인원</span></p>
        <p><strong>수용 인원:</strong> <span th:text="${matching.capacity}">수용 인원</span></p>
        <p><strong>모집 성별:</strong>
            <span th:switch="${matching.gender}">
              <span th:case="'F'">여성</span>
              <span th:case="'M'">남성</span>
              <span th:case="'DC'">성별무관</span>
            </span>
        </p>

    </div>

<!--<div>-->
<!--    <form th:if="${@rq.isLogin()}" th:action="@{/match/detail/delete/{id}(id=${matching.id})}" method="post">-->
<!--        <button type="submit" class="btn btn-light border" style="background-color: #1F2227; color: white"-->
<!--                th:if="${matching.user.id == @rq.user.id}"-->
<!--                onclick="return confirm('해당 게시물을 삭제하시겠습니까?')">삭제-->
<!--        </button>-->
<!--    </form>-->
<!--    <form th:if="${@rq.isLogin()}" th:action="@{/match/modify/{id}(id=${matching.id})}">-->
<!--        <button type="submit" class="btn btn-light border"-->
<!--                th:if="${matching.user.id == @rq.user.id}"-->
<!--                onclick="return confirm('해당 게시물을 수정하시겠습니까?')">수정-->
<!--        </button>-->
<!--    </form>-->
<!--</div>-->

<div class="participant-button">
    <a class="!bg-black p-3 text-white hover:cursor-pointer" th:if="${!alreadyWithPartner}" th:href="@{|/match/detail/${matching.getId()}/addPartner|}">참여하기</a>

    <!-- 매칭 파트너인 경우에 채팅 참여하기 버튼 활성화됨 -> 미니 프로필도 보이게 하기 -->
    <a class="!bg-black p-3 text-white hover:cursor-pointer" th:if="${alreadyWithPartner}" th:href="@{|/match/detail/${matching.getId()}/moveChatRoom|}">채팅 참여하기</a>
</div>

    <div class="mini-profile" th:if="${alreadyWithPartner}">
        <a th:each="matchingPartner : ${matching.matchingPartners}" class="card w-96 bg-base-100 shadow-xl"
           style="background-color: #1F2227; color: white; box-shadow: 3px 3px 5px #C0C0C0; margin: 30px;">
            <div class="card-body" th:if="${matchingPartner.inChatRoomTrueFalse}" style="margin: 10px">
                <div style="display: flex">
                    <img th:src="${matchingPartner.getUser().getAvatar()}">
                    <span th:text="${matchingPartner.getUser().getUsername()}" style="margin-left: 10px"></span>
                </div>

                <div>
                    <table class="tag-table">
                        <tbody>
                        <tr th:each="genreTag: ${matchingPartner.getUser().getUserTag().getGenreTag()}">
                        <td>
                            <span class="badge bg-green-500 badge-accent inline max-w-[10rem]"
                              th:text="${genreTag.getGenre()}"></span>
                        </td>
                        </tr>
                        <tr th:each="gameTag: ${matchingPartner.getUser().getUserTag().getGameTag()}">
                        <td>
                            <span class="badge bg-sky-500 badge-accent inline max-w-[10rem]"
                              th:text="${gameTag.getName()}">게임 제목</span>
                        </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pt-4">
                    <p class="mb-2">매너온도 : <span th:text="${matchingPartner.getUser().getTemperature()}"></span></p>
                    <progress class="progress progress-accent w-56 progress-custom" th:value="${matchingPartner.getUser().getTemperature()}" max="100">
                    </progress>
                </div>

            </div>
        </a>

    </div>

    <script>
        // 현재 시간을 가져오는 함수
        function getCurrentTime() {
            return new Date();
        }

        // deadlineDate에서 현재 시간을 뺀 후, 'n 시간 후' 형식으로 표시하는 함수
        function calculateTimeDifference(deadlineDate) {
            var currentTime = getCurrentTime();
            var deadline = new Date(deadlineDate);
            var differenceInHours = Math.floor((deadline - currentTime) / (1000 * 60 * 60));

            // 'n 시간 후' 형식으로 표시
            var output = differenceInHours + ' 시간 후';
            return output;
        }

        // deadlineDate 값을 가져와서 변환한 뒤, 해당 값을 대체하는 함수
        function replaceDeadlineDate() {
            var deadlineDateElement = document.getElementById('deadline');
            var deadlineDate = deadlineDateElement.innerHTML;
            var transformedDate = calculateTimeDifference(deadlineDate);
            deadlineDateElement.innerHTML = transformedDate;
        }

        // 페이지 로드 시 deadlineDate 값을 변환하여 대체
        window.onload = function() {
            replaceDeadlineDate();
        };
    </script>

</main>
</body>
</html>