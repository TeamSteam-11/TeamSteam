<html layout:decorate="~{common/layout.html}">
<head>
  <script th:inline="javascript">
    const token = /*[[${_csrf.token}]]*/ '';
  </script>

  <title>유저 목록</title>
  <style>
    body {
      color:white;
    }

    .table {
      display: flex;
      justify-content: center;
      margin-top: 50px;
    }

    .table thead tr:first-child th,
    .table thead tr:first-child td {
      background-color: #1F2227;
      text-align: center;
    }

    .table tbody tr th,
    .table tbody tr td {
      background-color: #202d3e;
      border:0px;
      text-align: center;
    }
  </style>
</head>

<body>

<main layout:fragment="main">
  <div style="display: flex; justify-content: center;">
    <table class="table shadow-2xl w-2/5 flex justify-center">
      <thead>
      <tr>
        <th>프로필</th>
        <th>회원 이름</th>
        <th>초대</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="user, loop : ${userList}">
        <td class="flex justify-center">
          <img th:src="${user.avatar}" alt="${user.username}'s avatar" class="rounded-lg w-10 h-10 m-auto"/>
        </td>
        <td th:text="${user.username}"></td>
        <td>
          <a th:href="@{/chat/{roomId}/inviteUser/{userId}(roomId=${chatRoom.id}, userId=${user.id})}"
             class="btn btn-sm btn-outline border-white text-white hover:bg-[#1F2227] hover:border-white invite">초대</a>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.invite').on('click', function(e) {
        e.preventDefault(); // Avoids redirecting

        var btn = $(this); // 클릭된 초대 버튼

        $.ajax({
          url: btn.attr('href'),
          type: 'GET',
          success: function(alreadyInvited) {
            console.log(alreadyInvited);
            if (alreadyInvited) {
              toastr.warning("이미 초대한 사람입니다.");
            } else {
              toastr.success("초대가 발송되었습니다.");
            }
          },
          error: function() {
            toastr.success('초대 요청에 실패했습니다');
          }
        });
      });
    });
  </script>
</main>
</body>
</html>